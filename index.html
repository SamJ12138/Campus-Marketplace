<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Campus Board â€” Gettysburg Community</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: {
        display: ['Instrument Serif', 'Georgia', 'serif'],
        body: ['Outfit', 'system-ui', 'sans-serif'],
      },
      colors: {
        brand: { 50:'#f0f4ff',100:'#dce5ff',200:'#b9cbff',300:'#8ba8ff',400:'#5c7cff',500:'#3d5afe',600:'#2541d8',700:'#1a32b0',800:'#142778',900:'#0d1a52' },
        sage: { 50:'#f4f8f4',100:'#e0ece0',200:'#b8d4b8',300:'#8ab88a',400:'#5c9a5c',500:'#3d7a3d',600:'#2d5e2d' },
        terra: { 50:'#fef7f0',100:'#fceadb',200:'#f8d0af',300:'#f2aa72',400:'#e8853e',500:'#d4691c',600:'#b5520e' },
        parchment: { 50:'#fdfcfa',100:'#faf7f2',200:'#f5efe5',300:'#ebe1d1',400:'#d9ccb4',500:'#c2b298',600:'#a89574' },
        charcoal: { 50:'#f6f5f4',100:'#edebe8',200:'#d8d4ce',300:'#b8b2a8',400:'#938b80',500:'#746c62',600:'#5b554c',700:'#45403a',800:'#302d29',900:'#1e1c1a',950:'#13120f' },
      },
    }
  }
}
</script>
<style>
/* â”€â”€â”€ ANIMATIONS â”€â”€â”€ */
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleUp{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
@keyframes slideInRight{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
@keyframes slideDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}
@keyframes heartPop{0%{transform:scale(1)}15%{transform:scale(1.35)}30%{transform:scale(.9)}45%{transform:scale(1.15)}60%{transform:scale(.95)}100%{transform:scale(1)}}
@keyframes shimmer{0%{background-position:-400px 0}100%{background-position:400px 0}}
@keyframes toastIn{0%{opacity:0;transform:translateY(16px) scale(.9)}100%{opacity:1;transform:translateY(0) scale(1)}}
@keyframes toastOut{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-8px) scale(.95)}}
@keyframes pulseRing{0%{box-shadow:0 0 0 0 rgba(61,90,254,.4)}70%{box-shadow:0 0 0 10px rgba(61,90,254,0)}100%{box-shadow:0 0 0 0 rgba(61,90,254,0)}}
@keyframes gentleFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes rotatePattern{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes pageEnter{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

html{scroll-behavior:smooth}
body{font-family:'Outfit',sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

/* â”€â”€â”€ SCROLLBAR â”€â”€â”€ */
*{scrollbar-width:thin;scrollbar-color:#d8d4ce transparent}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#d8d4ce;border-radius:99px}
::-webkit-scrollbar-thumb:hover{background:#b8b2a8}
.dark ::-webkit-scrollbar-thumb{background:#45403a}
.dark ::-webkit-scrollbar-thumb:hover{background:#5b554c}

/* â”€â”€â”€ GRAIN OVERLAY â”€â”€â”€ */
.grain::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9998;opacity:.35;mix-blend-mode:multiply;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.035'/%3E%3C/svg%3E")}
.dark .grain::after{opacity:.2;mix-blend-mode:screen}

/* â”€â”€â”€ STAGGER SYSTEM â”€â”€â”€ */
.stagger>*{opacity:0;animation:fadeUp .55s cubic-bezier(.22,1,.36,1) forwards}
.stagger>*:nth-child(1){animation-delay:.04s}
.stagger>*:nth-child(2){animation-delay:.08s}
.stagger>*:nth-child(3){animation-delay:.12s}
.stagger>*:nth-child(4){animation-delay:.16s}
.stagger>*:nth-child(5){animation-delay:.2s}
.stagger>*:nth-child(6){animation-delay:.24s}
.stagger>*:nth-child(7){animation-delay:.28s}
.stagger>*:nth-child(8){animation-delay:.32s}
.stagger>*:nth-child(9){animation-delay:.36s}
.stagger>*:nth-child(10){animation-delay:.4s}

.page-enter{animation:pageEnter .45s cubic-bezier(.22,1,.36,1) forwards}

/* â”€â”€â”€ CARD TILT HOVER â”€â”€â”€ */
.card-3d{transition:transform .35s cubic-bezier(.22,1,.36,1),box-shadow .35s ease;transform-style:preserve-3d;will-change:transform}
.card-3d:hover{box-shadow:0 20px 60px -15px rgba(0,0,0,.12),0 4px 20px -8px rgba(0,0,0,.08)}
.dark .card-3d:hover{box-shadow:0 20px 60px -15px rgba(0,0,0,.5),0 0 1px rgba(255,255,255,.05)}

/* â”€â”€â”€ GENERATIVE LISTING ART â”€â”€â”€ */
.art-pattern{position:relative;overflow:hidden}
.art-pattern::before,.art-pattern::after{content:'';position:absolute;border-radius:50%;opacity:.35;transition:transform .6s cubic-bezier(.22,1,.36,1)}
.art-pattern:hover::before{transform:scale(1.15) rotate(5deg)}
.art-pattern:hover::after{transform:scale(1.1) rotate(-5deg)}

/* pattern styles per category */
.art-books::before{width:120%;height:120%;top:-30%;left:-10%;background:conic-gradient(from 45deg,var(--a1),var(--a2),var(--a3),var(--a1))}
.art-books::after{width:80%;height:80%;bottom:-20%;right:-20%;background:radial-gradient(circle,var(--a2) 30%,transparent 70%)}
.art-camera::before{width:90%;height:90%;top:-10%;right:-20%;background:repeating-conic-gradient(var(--a1) 0% 25%,var(--a2) 0% 50%);border-radius:0}
.art-camera::after{width:60%;height:60%;bottom:10%;left:10%;background:radial-gradient(circle,var(--a3),transparent 60%)}
.art-scissors::before{width:150%;height:150%;top:-40%;left:-25%;background:repeating-linear-gradient(135deg,var(--a1) 0px,var(--a1) 20px,var(--a2) 20px,var(--a2) 40px)}
.art-scissors::after{width:70%;height:70%;bottom:-10%;right:-10%;background:radial-gradient(ellipse,var(--a3) 20%,transparent 70%);border-radius:40%}
.art-chip::before{width:100%;height:100%;top:-20%;left:0;background:linear-gradient(135deg,var(--a1) 25%,var(--a2) 25%,var(--a2) 50%,var(--a3) 50%,var(--a3) 75%,var(--a1) 75%);background-size:40px 40px;border-radius:0;opacity:.25}
.art-chip::after{width:80%;height:80%;top:10%;left:10%;background:radial-gradient(circle at 30% 40%,var(--a2),transparent 50%)}
.art-car::before{width:200%;height:80%;top:20%;left:-50%;background:repeating-linear-gradient(90deg,var(--a1) 0px,transparent 2px,transparent 30px);border-radius:0;opacity:.2}
.art-car::after{width:60%;height:120%;top:-10%;right:5%;background:linear-gradient(to bottom,var(--a2),var(--a3));border-radius:30%}
.art-music::before{width:120%;height:120%;top:-20%;left:-10%;background:conic-gradient(from 180deg,var(--a1),var(--a2),var(--a3),var(--a2),var(--a1))}
.art-music::after{width:50%;height:50%;top:25%;left:25%;background:var(--bg);border-radius:50%}
.art-chair::before{width:100%;height:100%;top:0;left:0;background:repeating-linear-gradient(45deg,var(--a1) 0px,var(--a1) 8px,transparent 8px,transparent 16px);border-radius:0;opacity:.2}
.art-chair::after{width:70%;height:70%;bottom:0;right:0;background:linear-gradient(225deg,var(--a2),var(--a3));border-radius:20%}
.art-default::before{width:130%;height:130%;top:-15%;left:-15%;background:radial-gradient(ellipse at 30% 40%,var(--a1),var(--a2) 50%,var(--a3) 100%)}
.art-default::after{width:50%;height:50%;bottom:10%;right:10%;background:var(--a3);border-radius:30% 70% 50% 50%}

/* â”€â”€â”€ HEART â”€â”€â”€ */
.heart-btn{transition:transform .2s ease}
.heart-btn:active{transform:scale(.85)}
.heart-btn svg{transition:transform .2s ease,fill .2s ease,color .2s ease}
.heart-btn:hover svg{transform:scale(1.15)}
.heart-btn.active svg{color:#ef4444;fill:#ef4444;animation:heartPop .5s ease}

/* â”€â”€â”€ TOAST â”€â”€â”€ */
#toast-container{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);z-index:9999;pointer-events:none}
.toast{animation:toastIn .3s ease forwards;font-family:'Outfit',sans-serif;pointer-events:auto}
.toast.exiting{animation:toastOut .25s ease forwards}

/* â”€â”€â”€ SHIMMER SKELETON â”€â”€â”€ */
.skeleton{background:linear-gradient(90deg,#f5efe5 25%,#faf7f2 37%,#f5efe5 63%);background-size:400px 100%;animation:shimmer 1.4s ease infinite}
.dark .skeleton{background:linear-gradient(90deg,#302d29 25%,#3a3632 37%,#302d29 63%);background-size:400px 100%}

/* â”€â”€â”€ MOBILE NAV â”€â”€â”€ */
.mobile-nav{padding-bottom:env(safe-area-inset-bottom,0px)}
.nav-indicator{transition:left .3s cubic-bezier(.22,1,.36,1),width .3s cubic-bezier(.22,1,.36,1)}
.nav-item{transition:color .2s ease,transform .15s ease;-webkit-tap-highlight-color:transparent}
.nav-item:active{transform:scale(.9)}

/* â”€â”€â”€ FOCUS â”€â”€â”€ */
*:focus-visible{outline:2px solid #5c7cff;outline-offset:2px;border-radius:4px}
.dark *:focus-visible{outline-color:#8ba8ff}

/* â”€â”€â”€ INPUTS â”€â”€â”€ */
input:focus,select:focus,textarea:focus{outline:none;border-color:#5c7cff;box-shadow:0 0 0 3px rgba(92,124,255,.12)}
.dark input:focus,.dark select:focus,.dark textarea:focus{border-color:#8ba8ff;box-shadow:0 0 0 3px rgba(139,168,255,.15)}

/* â”€â”€â”€ FAB PULSE â”€â”€â”€ */
.fab-pulse{animation:pulseRing 2s infinite}

/* â”€â”€â”€ MASONRY â”€â”€â”€ */
.masonry{columns:1;column-gap:16px}
@media(min-width:640px){.masonry{columns:2}}
@media(min-width:1024px){.masonry{columns:3}}
@media(min-width:1280px){.masonry{columns:4}}
.masonry>*{break-inside:avoid;margin-bottom:16px}

/* â”€â”€â”€ AUTH BG â”€â”€â”€ */
.auth-bg{position:relative;overflow:hidden}
.auth-bg::before{content:'';position:absolute;inset:0;
  background:
    radial-gradient(ellipse at 20% 50%,rgba(92,124,255,.12) 0%,transparent 50%),
    radial-gradient(ellipse at 80% 20%,rgba(136,186,136,.1) 0%,transparent 40%),
    radial-gradient(ellipse at 60% 80%,rgba(232,133,62,.08) 0%,transparent 40%);
}
.dark .auth-bg::before{
  background:
    radial-gradient(ellipse at 20% 50%,rgba(92,124,255,.08) 0%,transparent 50%),
    radial-gradient(ellipse at 80% 20%,rgba(136,186,136,.05) 0%,transparent 40%),
    radial-gradient(ellipse at 60% 80%,rgba(232,133,62,.04) 0%,transparent 40%);
}
.glass-card{backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  background:rgba(253,252,250,.72);border:1px solid rgba(216,212,206,.4)}
.dark .glass-card{background:rgba(30,28,26,.65);border:1px solid rgba(69,64,58,.5)}

/* â”€â”€â”€ SCROLL REVEAL â”€â”€â”€ */
.reveal{opacity:0;transform:translateY(20px);transition:opacity .5s cubic-bezier(.22,1,.36,1),transform .5s cubic-bezier(.22,1,.36,1)}
.reveal.visible{opacity:1;transform:translateY(0)}

/* â”€â”€â”€ PROFILE HEADER â”€â”€â”€ */
.profile-pattern{
  background:
    repeating-linear-gradient(45deg,transparent,transparent 20px,rgba(92,124,255,.04) 20px,rgba(92,124,255,.04) 22px),
    repeating-linear-gradient(-45deg,transparent,transparent 20px,rgba(138,184,138,.04) 20px,rgba(138,184,138,.04) 22px),
    linear-gradient(135deg,#fdfcfa,#f5efe5);
}
.dark .profile-pattern{
  background:
    repeating-linear-gradient(45deg,transparent,transparent 20px,rgba(92,124,255,.03) 20px,rgba(92,124,255,.03) 22px),
    repeating-linear-gradient(-45deg,transparent,transparent 20px,rgba(138,184,138,.03) 20px,rgba(138,184,138,.03) 22px),
    linear-gradient(135deg,#1e1c1a,#13120f);
}

/* â”€â”€â”€ TYPE SELECTION â”€â”€â”€ */
.type-card{transition:all .25s cubic-bezier(.22,1,.36,1);border:2px solid transparent}
.type-card:hover{transform:translateY(-2px);border-color:#b9cbff}
.type-card.selected{border-color:#3d5afe;background:linear-gradient(135deg,#f0f4ff,#dce5ff)}
.dark .type-card:hover{border-color:#45403a}
.dark .type-card.selected{border-color:#5c7cff;background:linear-gradient(135deg,rgba(61,90,254,.1),rgba(37,65,216,.15))}

/* â”€â”€â”€ SAFETY BANNER â”€â”€â”€ */
.safety-banner{position:relative;overflow:hidden}
.safety-banner::before{content:'';position:absolute;top:-50%;right:-20%;width:200px;height:200px;border-radius:50%;
  background:radial-gradient(circle,rgba(232,133,62,.08),transparent 70%)}
</style>
</head>

<body class="grain bg-parchment-50 text-charcoal-800 dark:bg-charcoal-950 dark:text-parchment-200 min-h-screen transition-colors duration-500">
<div id="app"></div>
<div id="toast-container"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MOCK DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CATEGORIES=[
  {id:'c1',name:'Tutoring',slug:'tutoring',icon:'ğŸ“š',art:'art-books'},
  {id:'c2',name:'Photography',slug:'photography',icon:'ğŸ“¸',art:'art-camera'},
  {id:'c3',name:'Hair & Beauty',slug:'hair-beauty',icon:'ğŸ’‡',art:'art-scissors'},
  {id:'c4',name:'Textbooks',slug:'textbooks',icon:'ğŸ“–',art:'art-books'},
  {id:'c5',name:'Electronics',slug:'electronics',icon:'ğŸ’»',art:'art-chip'},
  {id:'c6',name:'Rides',slug:'rides',icon:'ğŸš—',art:'art-car'},
  {id:'c7',name:'Music Lessons',slug:'music',icon:'ğŸµ',art:'art-music'},
  {id:'c8',name:'Furniture',slug:'furniture',icon:'ğŸª‘',art:'art-chair'},
];

const PALETTES=[
  {a1:'#b9cbff',a2:'#dce5ff',a3:'#5c7cff',bg:'#f0f4ff'},
  {a1:'#b8d4b8',a2:'#d4e8d4',a3:'#5c9a5c',bg:'#f4f8f4'},
  {a1:'#f8d0af',a2:'#fceadb',a3:'#e8853e',bg:'#fef7f0'},
  {a1:'#fecaca',a2:'#fee2e2',a3:'#f87171',bg:'#fef2f2'},
  {a1:'#c7d2fe',a2:'#e0e7ff',a3:'#818cf8',bg:'#eef2ff'},
  {a1:'#99f6e4',a2:'#ccfbf1',a3:'#2dd4bf',bg:'#f0fdfa'},
  {a1:'#fde68a',a2:'#fef3c7',a3:'#f59e0b',bg:'#fffbeb'},
  {a1:'#ddd6fe',a2:'#ede9fe',a3:'#8b5cf6',bg:'#f5f3ff'},
  {a1:'#fbcfe8',a2:'#fce7f3',a3:'#ec4899',bg:'#fdf2f8'},
  {a1:'#a7f3d0',a2:'#d1fae5',a3:'#34d399',bg:'#ecfdf5'},
];

const USERS=[
  {id:'u1',display_name:'Maya Rodriguez',class_year:2027,color:'#3d5afe'},
  {id:'u2',display_name:'James Chen',class_year:2026,color:'#059669'},
  {id:'u3',display_name:'Aisha Patel',class_year:2028,color:'#8b5cf6'},
  {id:'u4',display_name:'Tyler Brooks',class_year:2026,color:'#d97706'},
  {id:'u5',display_name:'Sophia Kim',class_year:2027,color:'#db2777'},
  {id:'u6',display_name:'David Okafor',class_year:2025,color:'#0891b2'},
  {id:'u7',display_name:'Emma Walsh',class_year:2028,color:'#e11d48'},
  {id:'u8',display_name:'Marcus Liu',class_year:2026,color:'#65a30d'},
];

const LISTINGS=[
  {id:'1',type:'service',title:'Calculus I & II Tutoring',desc:'Patient and thorough math tutoring from a senior math major. I break down complex concepts into simple steps. In-person at the library or via Zoom. Midterm prep sessions available.',price:'$25/hr',cat:CATEGORIES[0],loc:'on_campus',locHint:'Musselman Library',user:USERS[0],views:87,created:'2d ago',pal:0},
  {id:'2',type:'service',title:'Portrait & Event Photography',desc:'Capturing your college memories with a professional touch. Graduation photos, club events, Greek life formals, and candid campus shots. Quick turnaround â€” edited photos within 48 hours.',price:'$75/session',cat:CATEGORIES[1],loc:'flexible',locHint:'Anywhere on campus',user:USERS[1],views:134,created:'5h ago',pal:1},
  {id:'3',type:'service',title:'Box Braids & Protective Styles',desc:'Specializing in box braids, knotless braids, twists, and cornrows. Quality products that protect your natural hair. Each style includes a consultation. Book at least 3 days ahead.',price:'$80â€“$150',cat:CATEGORIES[2],loc:'on_campus',locHint:'Rice Hall 204',user:USERS[2],views:203,created:'1d ago',pal:2},
  {id:'4',type:'item',title:'Organic Chemistry 8th Ed. â€” Wade',desc:'Lightly used, no highlighting. Includes study guide. Retail $220, selling because I finished the course. Can meet anywhere on campus.',price:'$45',cat:CATEGORIES[3],loc:'on_campus',locHint:'CUB lobby',user:USERS[3],views:56,created:'3d ago',pal:3},
  {id:'5',type:'item',title:'MacBook Air M2 â€” Space Gray',desc:'2023 MacBook Air M2 in excellent condition. 8GB RAM, 256GB SSD. Battery cycle count under 100. Includes original charger and protective case. Upgrading to Pro.',price:'$750',cat:CATEGORIES[4],loc:'on_campus',locHint:'Science Center',user:USERS[4],views:312,created:'12h ago',pal:4},
  {id:'6',type:'service',title:'Weekend Rides to Baltimore / DC',desc:'Driving to Baltimore or DC most weekends. Usually leave Friday afternoon, return Sunday evening. Gas split appreciated but not required for first ride.',price:'$15 gas split',cat:CATEGORIES[5],loc:'off_campus',locHint:'Gettysburg â†’ Baltimore/DC',user:USERS[5],views:178,created:'6h ago',pal:5},
  {id:'7',type:'service',title:'Guitar Lessons for Beginners',desc:'Learn acoustic guitar from scratch! 8 years playing, 3 years teaching. Basic chords, strumming, your favorite songs. Spare guitar provided if you need one.',price:'$20/lesson',cat:CATEGORIES[6],loc:'on_campus',locHint:'Schmucker Hall',user:USERS[6],views:64,created:'4d ago',pal:6},
  {id:'8',type:'item',title:'IKEA Desk + Chair Combo',desc:'White MALM desk and MARKUS office chair. Great condition, small corner scratch. Perfect for dorm or apartment. Must pick up.',price:'$60 both',cat:CATEGORIES[7],loc:'off_campus',locHint:'Lincoln Ave apts',user:USERS[7],views:91,created:'1d ago',pal:7},
  {id:'9',type:'service',title:'Spanish Conversation Practice',desc:'Native speaker offering casual conversation sessions. Great for intermediate/advanced courses, improving fluency and pronunciation in a relaxed setting.',price:'$15/hr',cat:CATEGORIES[0],loc:'flexible',locHint:'Library or Servo',user:USERS[2],views:42,created:'2d ago',pal:8},
  {id:'10',type:'item',title:'TI-84 Plus CE Calculator',desc:'Graphing calculator in perfect condition. Fresh batteries, all standard programs loaded. Selling after finishing math-heavy courses.',price:'$55',cat:CATEGORIES[4],loc:'on_campus',locHint:'CUB',user:USERS[5],views:73,created:'8h ago',pal:9},
];

const THREADS=[
  {id:'t1',user:USERS[1],listing:LISTINGS[1],msg:'Sure, I can do graduation photos Saturday! What time works?',time:'2m ago',unread:2},
  {id:'t2',user:USERS[2],listing:LISTINGS[2],msg:'Thanks for booking! See you Thursday at 3pm ğŸ˜Š',time:'1h ago',unread:0},
  {id:'t3',user:USERS[3],listing:LISTINGS[3],msg:'Is the textbook still available?',time:'3h ago',unread:1},
  {id:'t4',user:USERS[4],listing:LISTINGS[4],msg:'Can you do $700 for the MacBook?',time:'yesterday',unread:0},
  {id:'t5',user:USERS[5],listing:LISTINGS[5],msg:'Heading to DC this Friday around 4pm, want to join?',time:'yesterday',unread:0},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S={
  loggedIn:false,user:USERS[0],route:'#/feed',
  filterType:null,filterCat:null,search:'',
  safetyDismissed:false,dark:false,
  favorites:new Set(['2','5']),selectedType:null,
  loading:false,pendingRedirect:null
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ICONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const I={
  heart:f=>`<svg width="18" height="18" viewBox="0 0 24 24" fill="${f?'currentColor':'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
  search:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>`,
  home:`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
  plus:`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>`,
  mail:`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>`,
  user:`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 0 0-16 0"/></svg>`,
  sun:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>`,
  moon:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>`,
  x:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>`,
  shield:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>`,
  pin:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`,
  eye:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>`,
  back:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
  flag:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>`,
  send:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>`,
  cam:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>`,
  bkmark:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>`,
  gear:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>`,
  list:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>`,
  check:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6 9 17l-5-5"/></svg>`,
  spark:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.9 5.8a2 2 0 0 1-1.287 1.288L3 12l5.8 1.9a2 2 0 0 1 1.288 1.288L12 21l1.9-5.8a2 2 0 0 1 1.287-1.288L21 12l-5.8-1.9a2 2 0 0 1-1.288-1.288Z"/></svg>`,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ini(n){return n.split(' ').map(w=>w[0]).join('').toUpperCase()}
function av(u,sz='w-10 h-10 text-sm'){return `<div class="${sz} rounded-full flex items-center justify-center text-white font-semibold shrink-0 ring-2 ring-white/50 dark:ring-charcoal-800/50 shadow-sm" style="background:${u.color}">${ini(u.display_name)}</div>`}
function nav(h){
  S.loading=true;render();
  setTimeout(()=>{S.loading=false;window.location.hash=h},180);
}
function toggleDark(){S.dark=!S.dark;document.documentElement.classList.toggle('dark',S.dark)}

function toast(msg,type='default'){
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  const bg=type==='fav'?'bg-rose-50 dark:bg-rose-900/40 text-rose-700 dark:text-rose-300 border-rose-200 dark:border-rose-800':'bg-parchment-100 dark:bg-charcoal-800 text-charcoal-700 dark:text-parchment-300 border-parchment-300 dark:border-charcoal-600';
  t.className=`toast ${bg} px-4 py-2.5 rounded-xl border shadow-lg text-sm font-medium flex items-center gap-2`;
  t.innerHTML=`${type==='fav'?I.heart(true):''}${msg}`;
  c.appendChild(t);
  setTimeout(()=>{t.classList.add('exiting');setTimeout(()=>t.remove(),250)},1800);
}

function toggleFav(id,e){
  if(e)e.stopPropagation();
  if(!requireAuth())return;
  const was=S.favorites.has(id);
  if(was)S.favorites.delete(id);else S.favorites.add(id);
  saveSession();
  toast(was?'Removed from saved':'Saved to favorites','fav');
  render();
}

function filtered(){
  let r=[...LISTINGS];
  if(S.filterType)r=r.filter(l=>l.type===S.filterType);
  if(S.filterCat)r=r.filter(l=>l.cat.slug===S.filterCat);
  if(S.search){const q=S.search.toLowerCase();r=r.filter(l=>l.title.toLowerCase().includes(q)||l.desc.toLowerCase().includes(q)||l.cat.name.toLowerCase().includes(q))}
  return r;
}

function artStyle(l){
  const p=PALETTES[l.pal];
  return `--a1:${p.a1};--a2:${p.a2};--a3:${p.a3};--bg:${p.bg};background:${p.bg}`;
}

// card tilt
function setupTilt(){
  document.querySelectorAll('.card-3d').forEach(card=>{
    card.addEventListener('mousemove',e=>{
      const r=card.getBoundingClientRect();
      const x=(e.clientX-r.left)/r.width-.5;
      const y=(e.clientY-r.top)/r.height-.5;
      card.style.transform=`perspective(800px) rotateY(${x*6}deg) rotateX(${-y*6}deg) scale(1.01)`;
    });
    card.addEventListener('mouseleave',()=>{card.style.transform=''});
  });
}

// scroll reveal
function setupReveal(){
  const obs=new IntersectionObserver(entries=>{
    entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');obs.unobserve(e.target)}});
  },{threshold:.1,rootMargin:'0px 0px -40px 0px'});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SESSION PERSISTENCE (30-day)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SESSION_KEY='cb_session';
const SESSION_MAX_AGE=30*24*60*60*1000;
function saveSession(){try{localStorage.setItem(SESSION_KEY,JSON.stringify({loggedIn:true,userId:S.user.id,storedAt:Date.now(),favorites:[...S.favorites]}))}catch(e){}}
function clearSession(){try{localStorage.removeItem(SESSION_KEY)}catch(e){}}
function restoreSession(){try{const raw=localStorage.getItem(SESSION_KEY);if(!raw)return false;const d=JSON.parse(raw);if(Date.now()-d.storedAt>SESSION_MAX_AGE){clearSession();return false}S.loggedIn=true;const u=USERS.find(x=>x.id===d.userId);if(u)S.user=u;if(d.favorites)S.favorites=new Set(d.favorites);return true}catch(e){return false}}
function requireAuth(cb){if(S.loggedIn){if(cb)cb();return true}S.pendingRedirect=S.route;nav('#/login');return false}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SKELETON SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function Skeleton(){
  const card=`<div class="rounded-2xl overflow-hidden bg-white dark:bg-charcoal-900 border border-parchment-200 dark:border-charcoal-800">
    <div class="skeleton aspect-[4/3]"></div>
    <div class="p-4 space-y-3"><div class="skeleton h-3 rounded-full w-1/3"></div><div class="skeleton h-4 rounded-full w-3/4"></div><div class="skeleton h-4 rounded-full w-1/2"></div><div class="skeleton h-3 rounded-full w-1/4 mt-4"></div></div>
  </div>`;
  return `<div class="mx-auto max-w-7xl px-4 sm:px-6 py-6"><div class="masonry stagger">${card.repeat(6)}</div></div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  COMPONENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function Header(){
  const unread=S.loggedIn?THREADS.reduce((s,t)=>s+t.unread,0):0;
  return `
  <header class="sticky top-0 z-40 border-b border-parchment-200/70 dark:border-charcoal-800/70 bg-parchment-50/85 dark:bg-charcoal-950/85 backdrop-blur-xl transition-colors duration-300">
    <div class="mx-auto max-w-7xl flex items-center h-[60px] px-4 sm:px-6 gap-3">
      <a onclick="nav('#/feed')" class="cursor-pointer shrink-0 group">
        <span class="font-display text-2xl italic text-brand-700 dark:text-brand-400 tracking-tight group-hover:text-brand-500 transition-colors">Campus Board</span>
      </a>
      <div class="hidden md:block flex-1 max-w-sm mx-6">
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-charcoal-400">${I.search}</span>
          <input type="text" placeholder="Search services & items..." value="${S.search}"
            oninput="S.search=this.value;render()"
            class="w-full h-9 rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white/70 dark:bg-charcoal-900/70 pl-9 pr-3 text-sm font-body placeholder:text-charcoal-400 dark:placeholder:text-charcoal-500 transition-all" />
        </div>
      </div>
      <nav class="hidden md:flex items-center gap-1 ml-auto">
        <a onclick="nav('#/feed')" class="cursor-pointer rounded-xl px-3 py-2 text-sm font-medium text-charcoal-500 dark:text-parchment-400 hover:bg-parchment-100 dark:hover:bg-charcoal-800 transition-colors">Browse</a>
        <a onclick="requireAuth(()=>nav('#/messages'))" class="cursor-pointer relative rounded-xl px-3 py-2 text-sm font-medium text-charcoal-500 dark:text-parchment-400 hover:bg-parchment-100 dark:hover:bg-charcoal-800 transition-colors flex items-center gap-1.5">
          ${I.mail}Messages
          ${unread>0?`<span class="absolute -top-0.5 -right-1 h-5 min-w-[20px] px-1 rounded-full bg-rose-500 text-white text-[10px] font-bold flex items-center justify-center shadow-sm">${unread}</span>`:''}
        </a>
        <a onclick="requireAuth(()=>nav('#/listings/new'))" class="cursor-pointer ml-1 inline-flex items-center gap-1.5 rounded-xl bg-brand-600 hover:bg-brand-500 active:scale-[.97] px-4 py-2 text-sm font-semibold text-white transition-all shadow-md shadow-brand-600/15">
          ${I.plus}Post
        </a>
      </nav>
      <div class="flex items-center gap-1.5 ${S.loggedIn?'':'ml-auto'}">
        <button onclick="toggleDark()" class="rounded-xl p-2 text-charcoal-400 dark:text-parchment-500 hover:bg-parchment-100 dark:hover:bg-charcoal-800 transition-colors" aria-label="Toggle theme">${S.dark?I.sun:I.moon}</button>
        ${S.loggedIn?`<a onclick="nav('#/profile')" class="cursor-pointer ml-0.5">${av(S.user,'w-8 h-8 text-xs')}</a>`:`
        <a onclick="nav('#/login')" class="cursor-pointer rounded-xl px-3 py-2 text-sm font-medium text-charcoal-500 dark:text-parchment-400 hover:bg-parchment-100 dark:hover:bg-charcoal-800 transition-colors hidden md:inline-flex">Sign in</a>
        <a onclick="nav('#/register')" class="cursor-pointer hidden md:inline-flex items-center rounded-xl bg-brand-600 hover:bg-brand-500 active:scale-[.97] px-4 py-2 text-sm font-semibold text-white transition-all shadow-md shadow-brand-600/15">Sign up</a>`}
      </div>
    </div>
  </header>`
}

function MobileNav(){
  const r=S.route;
  if(!S.loggedIn){
    const gi=(hash,icon,label,hl)=>{const a=r.startsWith(hash);return `<a onclick="nav('${hash}')" class="nav-item cursor-pointer flex flex-col items-center gap-0.5 py-2 px-3 relative ${hl?'text-brand-600 dark:text-brand-400':a?'text-brand-600 dark:text-brand-400':'text-charcoal-400 dark:text-charcoal-500'}"><span class="relative">${icon}</span><span class="text-[10px] font-medium">${label}</span>${a&&!hl?'<span class="absolute -bottom-0.5 w-5 h-0.5 rounded-full bg-brand-600 dark:bg-brand-400"></span>':''}</a>`};
    return `<nav class="mobile-nav md:hidden fixed bottom-0 inset-x-0 z-40 border-t border-parchment-200/60 dark:border-charcoal-800/60 bg-parchment-50/95 dark:bg-charcoal-950/95 backdrop-blur-xl"><div class="flex items-center justify-around px-1 pt-1 pb-1">${gi('#/feed',I.home,'Home')}${gi('#/feed',I.search,'Search')}${gi('#/login',I.user,'Sign in',true)}</div></nav>`;
  }
  const unread=THREADS.reduce((s,t)=>s+t.unread,0);
  const it=(hash,icon,label,badge)=>{
    const active=r.startsWith(hash);
    return `<a onclick="nav('${hash}')" class="nav-item cursor-pointer flex flex-col items-center gap-0.5 py-2 px-3 relative ${active?'text-brand-600 dark:text-brand-400':'text-charcoal-400 dark:text-charcoal-500'}">
      <span class="relative">${icon}${badge&&badge>0?`<span class="absolute -top-1.5 -right-2 h-4 min-w-[16px] px-0.5 rounded-full bg-rose-500 text-white text-[8px] font-bold flex items-center justify-center">${badge}</span>`:''}</span>
      <span class="text-[10px] font-medium">${label}</span>
      ${active?'<span class="absolute -bottom-0.5 w-5 h-0.5 rounded-full bg-brand-600 dark:bg-brand-400"></span>':''}
    </a>`;
  };
  return `
  <nav class="mobile-nav md:hidden fixed bottom-0 inset-x-0 z-40 border-t border-parchment-200/60 dark:border-charcoal-800/60 bg-parchment-50/95 dark:bg-charcoal-950/95 backdrop-blur-xl">
    <div class="flex items-center justify-around px-1 pt-1 pb-1">
      ${it('#/feed',I.home,'Feed')}
      ${it('#/messages',I.mail,'Messages',unread)}
      <a onclick="nav('#/listings/new')" class="cursor-pointer nav-item flex items-center justify-center w-12 h-12 -mt-6 rounded-2xl bg-brand-600 text-white shadow-lg shadow-brand-600/25 hover:bg-brand-500 transition-all fab-pulse">
        ${I.plus}
      </a>
      ${it('#/profile',I.user,'Profile')}
      ${it('#/profile',I.bkmark,'Saved')}
    </div>
  </nav>`;
}

function SafetyBanner(){
  if(S.safetyDismissed)return '';
  return `
  <div class="safety-banner rounded-2xl bg-gradient-to-br from-terra-50 via-parchment-50 to-sage-50 dark:from-terra-600/10 dark:via-charcoal-900 dark:to-sage-600/10 border border-terra-200/40 dark:border-terra-800/20 px-5 py-4 animate-fadeIn" style="animation:fadeIn .5s ease">
    <div class="flex items-start gap-3">
      <div class="mt-0.5 w-8 h-8 rounded-lg bg-terra-100 dark:bg-terra-900/30 flex items-center justify-center text-terra-500 dark:text-terra-400 shrink-0">${I.shield}</div>
      <div class="flex-1 min-w-0">
        <p class="text-sm font-semibold text-charcoal-800 dark:text-parchment-200 font-display text-base">Stay safe on campus</p>
        <p class="mt-0.5 text-sm text-charcoal-500 dark:text-parchment-400/80 leading-relaxed">Meet in public places. Never share financial info. Report suspicious activity.</p>
      </div>
      <button onclick="S.safetyDismissed=true;render()" class="shrink-0 rounded-lg p-1.5 text-charcoal-400 hover:bg-parchment-200/50 dark:hover:bg-charcoal-700/50 transition-colors" aria-label="Dismiss">${I.x}</button>
    </div>
  </div>`;
}

function ListingCard(l){
  const fav=S.favorites.has(l.id);
  const isSvc=l.type==='service';
  return `
  <div class="card-3d rounded-2xl bg-white dark:bg-charcoal-900 border border-parchment-200/60 dark:border-charcoal-800/60 overflow-hidden cursor-pointer group" onclick="nav('#/listings/${l.id}')">
    <div class="relative aspect-[4/3] overflow-hidden art-pattern ${l.cat.art}" style="${artStyle(l)}">
      <div class="absolute inset-0 flex items-center justify-center z-10">
        <span class="text-5xl opacity-50 group-hover:scale-110 group-hover:opacity-70 transition-all duration-500" style="filter:drop-shadow(0 2px 8px rgba(0,0,0,.1))">${l.cat.icon}</span>
      </div>
      <div class="absolute top-3 left-3 z-10">
        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-lg text-xs font-semibold backdrop-blur-md shadow-sm ${isSvc?'bg-brand-600/90 text-white':'bg-sage-600/90 text-white'}">
          ${I.spark}${isSvc?'Service':'Item'}
        </span>
      </div>
      <button onclick="toggleFav('${l.id}',event)" class="heart-btn ${fav?'active':''} absolute top-3 right-3 z-10 w-9 h-9 rounded-xl bg-white/70 dark:bg-charcoal-900/70 backdrop-blur-md flex items-center justify-center text-charcoal-400 hover:text-rose-500 shadow-sm transition-all" aria-label="Favorite">
        ${I.heart(fav)}
      </button>
    </div>
    <div class="p-4">
      <div class="flex items-center gap-1.5 mb-2">
        <span class="text-xs text-charcoal-400 dark:text-charcoal-500 font-medium">${l.cat.name}</span>
        <span class="w-1 h-1 rounded-full bg-charcoal-300 dark:bg-charcoal-600"></span>
        <span class="text-xs text-charcoal-400 dark:text-charcoal-500">${l.created}</span>
      </div>
      <h3 class="font-semibold text-[15px] text-charcoal-800 dark:text-parchment-100 leading-snug line-clamp-2 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors duration-200">${l.title}</h3>
      <p class="mt-2 text-base font-display italic text-brand-700 dark:text-brand-400">${l.price}</p>
      <div class="mt-3 pt-3 border-t border-parchment-100 dark:border-charcoal-800 flex items-center justify-between">
        <div class="flex items-center gap-2 min-w-0">
          ${av(l.user,'w-6 h-6 text-[9px] ring-1')}
          <span class="text-xs text-charcoal-500 dark:text-charcoal-400 truncate">${l.user.display_name} '${String(l.user.class_year).slice(-2)}</span>
        </div>
        <div class="flex items-center gap-1 text-charcoal-400 dark:text-charcoal-500">${I.eye}<span class="text-xs">${l.views}</span></div>
      </div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function LoginPage(){
  return `
  <div class="auth-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md page-enter">
      <div class="text-center mb-10">
        <h1 class="font-display text-5xl italic text-brand-700 dark:text-brand-400 tracking-tight leading-none">Campus Board</h1>
        <p class="mt-3 text-charcoal-400 dark:text-charcoal-500 text-sm tracking-wide uppercase font-medium">Gettysburg College Marketplace</p>
      </div>
      <div class="glass-card rounded-3xl shadow-2xl shadow-charcoal-900/5 dark:shadow-charcoal-950/40 p-8 sm:p-10">
        <h2 class="font-display text-3xl italic text-charcoal-800 dark:text-parchment-100">Welcome back</h2>
        <p class="mt-1.5 text-sm text-charcoal-500 dark:text-charcoal-400">Sign in to your account</p>
        <form onsubmit="event.preventDefault();S.loggedIn=true;saveSession();const r=S.pendingRedirect||'#/feed';S.pendingRedirect=null;nav(r)" class="mt-8 space-y-5">
          <div>
            <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Email</label>
            <input type="email" placeholder="you@gettysburg.edu" required class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-600 bg-white/60 dark:bg-charcoal-800/60 px-4 py-3 text-sm transition-all" />
          </div>
          <div>
            <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Password</label>
            <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-600 bg-white/60 dark:bg-charcoal-800/60 px-4 py-3 text-sm transition-all" />
          </div>
          <button type="submit" class="w-full rounded-xl bg-brand-600 hover:bg-brand-500 active:scale-[.98] px-4 py-3 text-sm font-semibold text-white shadow-lg shadow-brand-600/20 transition-all">Sign in</button>
        </form>
        <p class="mt-8 text-center text-sm text-charcoal-400 dark:text-charcoal-500">
          New here? <a onclick="nav('#/register')" class="cursor-pointer font-semibold text-brand-600 dark:text-brand-400 hover:underline underline-offset-2">Create an account</a>
        </p>
      </div>
    </div>
  </div>`
}

function RegisterPage(){
  return `
  <div class="auth-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md page-enter">
      <div class="text-center mb-10">
        <h1 class="font-display text-5xl italic text-brand-700 dark:text-brand-400 tracking-tight leading-none">Campus Board</h1>
        <p class="mt-3 text-charcoal-400 dark:text-charcoal-500 text-sm tracking-wide uppercase font-medium">Join the Community</p>
      </div>
      <div class="glass-card rounded-3xl shadow-2xl shadow-charcoal-900/5 dark:shadow-charcoal-950/40 p-8 sm:p-10">
        <h2 class="font-display text-3xl italic text-charcoal-800 dark:text-parchment-100">Create account</h2>
        <p class="mt-1.5 text-sm text-charcoal-500 dark:text-charcoal-400">Use your .edu email to get started</p>
        <form onsubmit="event.preventDefault();S.loggedIn=true;saveSession();const r=S.pendingRedirect||'#/feed';S.pendingRedirect=null;nav(r)" class="mt-8 space-y-5">
          <div>
            <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Display name</label>
            <input type="text" placeholder="How others will see you" required class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-600 bg-white/60 dark:bg-charcoal-800/60 px-4 py-3 text-sm transition-all" />
          </div>
          <div>
            <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">College email</label>
            <input type="email" id="reg-email" placeholder="you@gettysburg.edu" required oninput="updateEmail(this.value)" class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-600 bg-white/60 dark:bg-charcoal-800/60 px-4 py-3 text-sm transition-all" />
            <p id="email-hint" class="mt-1.5 text-xs text-charcoal-400">Must be a .edu email address</p>
          </div>
          <div>
            <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Password</label>
            <input type="password" id="reg-pass" placeholder="At least 8 characters" required oninput="updatePw(this.value)" class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-600 bg-white/60 dark:bg-charcoal-800/60 px-4 py-3 text-sm transition-all" />
            <div class="mt-2.5 flex gap-1.5" id="pw-bar"><div class="h-1.5 flex-1 rounded-full bg-parchment-200 dark:bg-charcoal-700 transition-colors duration-300"></div><div class="h-1.5 flex-1 rounded-full bg-parchment-200 dark:bg-charcoal-700 transition-colors duration-300"></div><div class="h-1.5 flex-1 rounded-full bg-parchment-200 dark:bg-charcoal-700 transition-colors duration-300"></div><div class="h-1.5 flex-1 rounded-full bg-parchment-200 dark:bg-charcoal-700 transition-colors duration-300"></div></div>
            <p id="pw-text" class="mt-1.5 text-xs text-charcoal-400">Enter a password</p>
          </div>
          <button type="submit" class="w-full rounded-xl bg-brand-600 hover:bg-brand-500 active:scale-[.98] px-4 py-3 text-sm font-semibold text-white shadow-lg shadow-brand-600/20 transition-all">Create account</button>
        </form>
        <p class="mt-8 text-center text-sm text-charcoal-400 dark:text-charcoal-500">
          Already have an account? <a onclick="nav('#/login')" class="cursor-pointer font-semibold text-brand-600 dark:text-brand-400 hover:underline underline-offset-2">Sign in</a>
        </p>
      </div>
    </div>
  </div>`
}

function FeedPage(){
  const items=filtered();
  const pill=(val,label)=>{
    const active=S.filterType===val;
    const cls=active?(val==='service'?'bg-brand-600 text-white shadow-md shadow-brand-600/15':val==='item'?'bg-sage-600 text-white shadow-md shadow-sage-600/15':'bg-charcoal-800 dark:bg-parchment-200 text-white dark:text-charcoal-900 shadow-md'):'bg-white dark:bg-charcoal-900 text-charcoal-600 dark:text-parchment-400 border border-parchment-200 dark:border-charcoal-700 hover:border-parchment-400 dark:hover:border-charcoal-500';
    return `<button onclick="S.filterType=${val===S.filterType?'null':`'${val}'`};S.filterCat=null;render()" class="rounded-xl px-4 py-2 text-sm font-medium transition-all whitespace-nowrap ${cls}">${label}</button>`;
  };
  return `
  <div class="mx-auto max-w-7xl px-4 sm:px-6 py-6 space-y-6 pb-28 md:pb-8 page-enter">
    ${SafetyBanner()}
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4">
      <div>
        <h1 class="font-display text-3xl sm:text-4xl italic text-charcoal-800 dark:text-parchment-100 leading-none">
          ${S.filterType==='service'?'Services':S.filterType==='item'?'Items for Sale':'Discover'}
        </h1>
        <p class="text-sm text-charcoal-400 dark:text-charcoal-500 mt-1.5">${items.length} listing${items.length!==1?'s':''} from your campus community</p>
      </div>
      <div class="relative sm:hidden">
        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-charcoal-400">${I.search}</span>
        <input type="text" placeholder="Search..." value="${S.search}" oninput="S.search=this.value;render()"
          class="w-full h-10 rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white dark:bg-charcoal-900 pl-9 pr-3 text-sm placeholder:text-charcoal-400 transition-all" />
      </div>
    </div>

    <div class="flex items-center gap-2 overflow-x-auto pb-1 [-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden">
      ${pill(null,'All')}${pill('service','Services')}${pill('item','Items')}
      <div class="h-6 w-px bg-parchment-200 dark:bg-charcoal-700 shrink-0 mx-1"></div>
      ${CATEGORIES.map(c=>{
        const active=S.filterCat===c.slug;
        return `<button onclick="S.filterCat=${active?'null':`'${c.slug}'`};render()" class="shrink-0 rounded-xl px-3 py-2 text-sm font-medium whitespace-nowrap transition-all ${active?'bg-charcoal-800 dark:bg-parchment-200 text-white dark:text-charcoal-900 shadow-md':'bg-white dark:bg-charcoal-900 text-charcoal-500 dark:text-parchment-400 border border-parchment-200 dark:border-charcoal-700 hover:border-parchment-400'}">${c.icon} ${c.name}</button>`;
      }).join('')}
    </div>

    ${items.length===0?`
    <div class="flex flex-col items-center justify-center py-24 text-center page-enter">
      <div class="w-20 h-20 rounded-3xl bg-parchment-100 dark:bg-charcoal-800 flex items-center justify-center mb-5"><span class="text-4xl" style="animation:gentleFloat 3s ease-in-out infinite">ğŸ”</span></div>
      <h3 class="text-lg font-display italic text-charcoal-700 dark:text-parchment-200">Nothing here yet</h3>
      <p class="mt-2 text-sm text-charcoal-400 dark:text-charcoal-500 max-w-sm">Try adjusting your filters or search terms.</p>
      <button onclick="S.filterType=null;S.filterCat=null;S.search='';render()" class="mt-5 rounded-xl bg-brand-600 hover:bg-brand-500 px-6 py-2.5 text-sm font-medium text-white transition-all shadow-md shadow-brand-600/15">Clear all filters</button>
    </div>`:`
    <div class="masonry stagger">
      ${items.map(l=>ListingCard(l)).join('')}
    </div>`}
  </div>`
}

function DetailPage(id){
  const l=LISTINGS.find(x=>x.id===id);
  if(!l)return `<div class="p-12 text-center font-display italic text-xl text-charcoal-400">Listing not found</div>`;
  const fav=S.favorites.has(l.id);const isSvc=l.type==='service';
  return `
  <div class="mx-auto max-w-5xl px-4 sm:px-6 py-6 pb-28 md:pb-8 page-enter">
    <button onclick="nav('#/feed')" class="inline-flex items-center gap-1.5 text-sm text-charcoal-500 dark:text-charcoal-400 hover:text-charcoal-700 dark:hover:text-parchment-200 mb-5 transition-colors font-medium">${I.back} Back to listings</button>
    <div class="grid md:grid-cols-3 gap-8">
      <div class="md:col-span-2">
        <div class="relative aspect-[16/10] rounded-3xl overflow-hidden art-pattern ${l.cat.art}" style="${artStyle(l)}">
          <div class="absolute inset-0 flex items-center justify-center z-10"><span class="text-8xl opacity-40" style="filter:drop-shadow(0 4px 12px rgba(0,0,0,.1))">${l.cat.icon}</span></div>
          <div class="absolute top-5 left-5 z-10">
            <span class="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl text-xs font-semibold backdrop-blur-md ${isSvc?'bg-brand-600/90 text-white':'bg-sage-600/90 text-white'} shadow-lg">${I.spark}${isSvc?'Service':'Item'}</span>
          </div>
          <button onclick="toggleFav('${l.id}',event)" class="heart-btn ${fav?'active':''} absolute top-5 right-5 z-10 w-11 h-11 rounded-xl bg-white/70 dark:bg-charcoal-900/70 backdrop-blur-md flex items-center justify-center text-charcoal-400 hover:text-rose-500 shadow-lg transition-all" aria-label="Favorite">${I.heart(fav)}</button>
        </div>
        <div class="mt-8 reveal">
          <h2 class="font-display text-xl italic text-charcoal-700 dark:text-parchment-200 mb-4">About this listing</h2>
          <p class="text-[15px] text-charcoal-600 dark:text-parchment-300 leading-relaxed">${l.desc}</p>
        </div>
      </div>
      <div class="space-y-5">
        <div>
          <div class="flex items-center gap-2 mb-3"><span class="text-xs font-medium text-charcoal-400 dark:text-charcoal-500 uppercase tracking-wider">${l.cat.name}</span><span class="w-1 h-1 rounded-full bg-charcoal-300 dark:bg-charcoal-600"></span><span class="text-xs text-charcoal-400 dark:text-charcoal-500">${l.created}</span></div>
          <h1 class="font-display text-3xl italic text-charcoal-800 dark:text-parchment-100 leading-tight">${l.title}</h1>
        </div>
        <div class="rounded-2xl bg-brand-50 dark:bg-brand-900/20 border border-brand-100 dark:border-brand-800/30 px-5 py-4">
          <p class="font-display text-3xl italic text-brand-700 dark:text-brand-400">${l.price}</p>
        </div>
        <div class="flex items-center gap-2 text-sm text-charcoal-500 dark:text-charcoal-400">${I.pin}<span>${l.locHint}</span>
          <span class="inline-flex items-center px-2 py-0.5 rounded-lg text-xs font-medium bg-parchment-100 dark:bg-charcoal-800 text-charcoal-500 dark:text-charcoal-400">${l.loc==='on_campus'?'On Campus':l.loc==='off_campus'?'Off Campus':'Flexible'}</span>
        </div>
        <div class="flex items-center gap-1.5 text-xs text-charcoal-400 dark:text-charcoal-500">${I.eye}<span>${l.views} views</span></div>
        <div class="rounded-2xl border border-parchment-200/60 dark:border-charcoal-800/60 bg-white dark:bg-charcoal-900 p-5">
          <div class="flex items-center gap-3">
            ${av(l.user,'w-12 h-12 text-sm')}
            <div><p class="font-semibold text-sm text-charcoal-800 dark:text-parchment-100">${l.user.display_name}</p><p class="text-xs text-charcoal-400 dark:text-charcoal-500">Class of ${l.user.class_year}</p></div>
          </div>
        </div>
        <div class="flex gap-2.5">
          <button onclick="requireAuth(()=>nav('#/messages'))" class="flex-1 rounded-xl bg-brand-600 hover:bg-brand-500 active:scale-[.97] py-3 text-sm font-semibold text-white shadow-lg shadow-brand-600/15 transition-all flex items-center justify-center gap-2">${I.send} Message</button>
          <button onclick="requireAuth(()=>toast('Report submitted'))" class="rounded-xl border border-parchment-300 dark:border-charcoal-700 hover:bg-parchment-100 dark:hover:bg-charcoal-800 px-4 py-3 text-charcoal-400 transition-colors" aria-label="Report">${I.flag}</button>
        </div>
      </div>
    </div>
  </div>`
}

function CreatePage(){
  return `
  <div class="mx-auto max-w-2xl px-4 sm:px-6 py-6 pb-28 md:pb-8 page-enter">
    <button onclick="nav('#/feed')" class="inline-flex items-center gap-1.5 text-sm text-charcoal-500 dark:text-charcoal-400 hover:text-charcoal-700 dark:hover:text-parchment-200 mb-5 transition-colors font-medium">${I.back} Back</button>
    <h1 class="font-display text-3xl sm:text-4xl italic text-charcoal-800 dark:text-parchment-100 mb-8">Create a Listing</h1>
    <div class="mb-8">
      <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-3 uppercase tracking-wider">What are you offering?</label>
      <div class="grid grid-cols-2 gap-4">
        <button onclick="S.selectedType='service';render()" class="type-card ${S.selectedType==='service'?'selected':''} rounded-2xl p-6 bg-white dark:bg-charcoal-900 text-left">
          <span class="text-4xl mb-3 block">ğŸ› ï¸</span>
          <p class="font-semibold text-charcoal-800 dark:text-parchment-100">Service</p>
          <p class="text-xs text-charcoal-400 dark:text-charcoal-500 mt-1">Tutoring, photography, rides...</p>
        </button>
        <button onclick="S.selectedType='item';render()" class="type-card ${S.selectedType==='item'?'selected':''} rounded-2xl p-6 bg-white dark:bg-charcoal-900 text-left">
          <span class="text-4xl mb-3 block">ğŸ“¦</span>
          <p class="font-semibold text-charcoal-800 dark:text-parchment-100">Item</p>
          <p class="text-xs text-charcoal-400 dark:text-charcoal-500 mt-1">Textbooks, electronics, furniture...</p>
        </button>
      </div>
    </div>
    <form onsubmit="event.preventDefault();toast('Listing published!');nav('#/feed')" class="space-y-6">
      <div><label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Title</label><input type="text" placeholder="e.g., Calculus Tutoring â€” Patient & Thorough" required class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white dark:bg-charcoal-900 px-4 py-3 text-sm transition-all" /></div>
      <div><label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Category</label><select required class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white dark:bg-charcoal-900 px-4 py-3 text-sm transition-all appearance-none"><option value="">Select a category</option>${CATEGORIES.map(c=>`<option value="${c.slug}">${c.icon} ${c.name}</option>`).join('')}</select></div>
      <div><label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Description</label><textarea rows="4" placeholder="Describe what you're offering in detail..." required class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white dark:bg-charcoal-900 px-4 py-3 text-sm transition-all resize-y"></textarea></div>
      <div><label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Price hint</label><input type="text" placeholder="e.g., $25/hr, $50, Free" class="w-full rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white dark:bg-charcoal-900 px-4 py-3 text-sm transition-all" /></div>
      <div>
        <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-3 uppercase tracking-wider">Location</label>
        <div class="flex flex-wrap gap-2.5">
          ${['on_campus:On Campus:ğŸ«','off_campus:Off Campus:ğŸ ','flexible:Flexible:ğŸ”„'].map(o=>{const[v,l,ic]=o.split(':');return `<label class="cursor-pointer inline-flex items-center gap-2 rounded-xl border border-parchment-300 dark:border-charcoal-700 bg-white dark:bg-charcoal-900 px-4 py-2.5 text-sm hover:border-brand-300 dark:hover:border-brand-700 transition-all has-[:checked]:border-brand-500 has-[:checked]:bg-brand-50 dark:has-[:checked]:bg-brand-900/20 has-[:checked]:shadow-sm"><input type="radio" name="location" value="${v}" class="sr-only" /><span>${ic}</span><span class="text-charcoal-700 dark:text-parchment-200">${l}</span></label>`}).join('')}
        </div>
      </div>
      <div>
        <label class="block text-xs font-semibold text-charcoal-600 dark:text-parchment-300 mb-2 uppercase tracking-wider">Photos</label>
        <div class="border-2 border-dashed border-parchment-300 dark:border-charcoal-700 rounded-2xl p-10 text-center hover:border-brand-400 dark:hover:border-brand-600 transition-all cursor-pointer group">
          <div class="text-charcoal-300 dark:text-charcoal-600 mb-2 group-hover:text-brand-400 transition-colors mx-auto w-fit">${I.cam}</div>
          <p class="text-sm text-charcoal-500 dark:text-charcoal-400 font-medium">Click to add photos</p>
          <p class="text-xs text-charcoal-400 dark:text-charcoal-500 mt-1">Up to 5 photos, max 10MB each</p>
        </div>
      </div>
      <button type="submit" class="w-full rounded-xl bg-brand-600 hover:bg-brand-500 active:scale-[.98] px-4 py-3.5 text-sm font-semibold text-white shadow-lg shadow-brand-600/15 transition-all">Publish Listing</button>
    </form>
  </div>`
}

function MessagesPage(){
  return `
  <div class="mx-auto max-w-2xl px-4 sm:px-6 py-6 pb-28 md:pb-8 page-enter">
    <h1 class="font-display text-3xl sm:text-4xl italic text-charcoal-800 dark:text-parchment-100 mb-6">Messages</h1>
    <div class="space-y-3 stagger">
      ${THREADS.map(t=>`
      <div class="flex items-center gap-4 p-4 rounded-2xl bg-white dark:bg-charcoal-900 border border-parchment-200/60 dark:border-charcoal-800/60 hover:border-brand-200 dark:hover:border-brand-800/40 cursor-pointer transition-all card-3d ${t.unread>0?'ring-1 ring-brand-100 dark:ring-brand-900/30':''}">
        <div class="relative shrink-0">
          ${av(t.user,'w-12 h-12 text-sm')}
          ${t.unread>0?'<span class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full bg-brand-500 border-2 border-white dark:border-charcoal-900"></span>':''}
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex items-center justify-between gap-2 mb-0.5">
            <p class="${t.unread>0?'font-semibold':'font-medium'} text-sm text-charcoal-800 dark:text-parchment-100 truncate">${t.user.display_name}</p>
            <span class="text-xs text-charcoal-400 dark:text-charcoal-500 shrink-0">${t.time}</span>
          </div>
          <p class="text-xs text-charcoal-400 dark:text-charcoal-500 mb-1">Re: ${t.listing.title}</p>
          <p class="text-sm ${t.unread>0?'text-charcoal-700 dark:text-parchment-200 font-medium':'text-charcoal-500 dark:text-charcoal-400'} truncate">${t.msg}</p>
        </div>
        ${t.unread>0?`<span class="shrink-0 h-6 min-w-[24px] px-2 rounded-full bg-brand-600 text-white text-[11px] font-bold flex items-center justify-center">${t.unread}</span>`:''}
      </div>`).join('')}
    </div>
  </div>`
}

function ProfilePage(){
  const u=S.user;
  const myCount=LISTINGS.filter(l=>l.user.id===u.id).length;
  const navCard=(icon,label,desc,accent)=>`
    <div class="flex items-center gap-4 p-5 rounded-2xl bg-white dark:bg-charcoal-900 border border-parchment-200/60 dark:border-charcoal-800/60 hover:border-${accent||'brand'}-200 dark:hover:border-${accent||'brand'}-800/40 cursor-pointer card-3d transition-all">
      <div class="w-11 h-11 rounded-xl bg-${accent||'brand'}-50 dark:bg-${accent||'brand'}-900/20 flex items-center justify-center text-${accent||'brand'}-600 dark:text-${accent||'brand'}-400">${icon}</div>
      <div class="flex-1"><p class="font-semibold text-sm text-charcoal-800 dark:text-parchment-100">${label}</p><p class="text-xs text-charcoal-400 dark:text-charcoal-500 mt-0.5">${desc}</p></div>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-charcoal-300 dark:text-charcoal-600"><path d="m9 18 6-6-6-6"/></svg>
    </div>`;
  return `
  <div class="mx-auto max-w-lg px-4 sm:px-6 py-6 pb-28 md:pb-8 page-enter">
    <div class="profile-pattern rounded-3xl p-8 text-center mb-6 relative overflow-hidden">
      <div class="relative z-10">
        <div class="inline-block relative">
          ${av(u,'w-24 h-24 text-3xl ring-4 ring-white dark:ring-charcoal-900')}
          <button class="absolute bottom-0 right-0 w-8 h-8 rounded-full bg-white dark:bg-charcoal-800 border-2 border-parchment-100 dark:border-charcoal-700 flex items-center justify-center text-charcoal-500 shadow-md hover:bg-parchment-50 transition-colors">${I.cam}</button>
        </div>
        <h1 class="mt-5 font-display text-2xl italic text-charcoal-800 dark:text-parchment-100">${u.display_name}</h1>
        <p class="text-sm text-charcoal-500 dark:text-charcoal-400 mt-1">Class of ${u.class_year} Â· Gettysburg College</p>
        <p class="mt-3 text-sm text-charcoal-600 dark:text-parchment-300 max-w-xs mx-auto leading-relaxed">Math major who loves helping others learn. Available for tutoring and study groups!</p>
      </div>
    </div>
    <div class="space-y-3 stagger">
      ${navCard(I.list,'My Listings',`${myCount} active listing${myCount!==1?'s':''}`,'brand')}
      ${navCard(I.bkmark,'Saved Listings',`${S.favorites.size} saved`,'terra')}
      ${navCard(I.gear,'Settings','Password, notifications, blocked users','charcoal')}
      <div class="pt-3"><button onclick="S.loggedIn=false;clearSession();nav('#/feed')" class="w-full rounded-2xl border border-rose-200 dark:border-rose-900/40 text-rose-600 dark:text-rose-400 hover:bg-rose-50 dark:hover:bg-rose-900/10 py-3.5 text-sm font-medium transition-colors">Sign out</button></div>
    </div>
  </div>`
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ROUTER + RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _authPage=false;
function getPage(){
  _authPage=false;
  if(S.loading)return Skeleton();
  const h=S.route;
  if(h==='#/register'){_authPage=true;return RegisterPage()}
  if(h==='#/login'){_authPage=true;return LoginPage()}
  if(!S.loggedIn&&(h.startsWith('#/listings/new')||h.startsWith('#/messages')||h.startsWith('#/profile'))){
    S.pendingRedirect=h;_authPage=true;return LoginPage();
  }
  if(h.startsWith('#/listings/new'))return CreatePage();
  if(h.startsWith('#/listings/')){return DetailPage(h.split('/').pop())}
  if(h.startsWith('#/messages'))return MessagesPage();
  if(h.startsWith('#/profile'))return ProfilePage();
  return FeedPage();
}

function render(){
  const app=document.getElementById('app');
  const page=getPage();
  const chrome=!_authPage;
  app.innerHTML=`
    ${chrome?Header():`<div class="fixed top-4 right-4 z-50"><button onclick="toggleDark()" class="rounded-xl p-2.5 bg-white/60 dark:bg-charcoal-900/60 backdrop-blur-md border border-parchment-200/40 dark:border-charcoal-700/40 text-charcoal-500 dark:text-parchment-400 hover:bg-parchment-100 dark:hover:bg-charcoal-800 transition-all shadow-sm">${S.dark?I.sun:I.moon}</button></div>`}
    <main>${page}</main>
    ${chrome?MobileNav():''}`;
  requestAnimationFrame(()=>{setupTilt();setupReveal()});
}

// registration helpers
function updateEmail(v){
  const h=document.getElementById('email-hint');if(!h)return;
  if(v.endsWith('.edu')){h.innerHTML=`<span class="text-sage-600 dark:text-sage-400 font-medium">${I.check} Valid .edu email</span>`;h.className='mt-1.5 text-xs flex items-center gap-1'}
  else if(v.includes('@')){h.textContent='Must be a .edu email address';h.className='mt-1.5 text-xs text-rose-500 dark:text-rose-400'}
  else{h.textContent='Must be a .edu email address';h.className='mt-1.5 text-xs text-charcoal-400'}
}
function updatePw(v){
  const bar=document.getElementById('pw-bar'),txt=document.getElementById('pw-text');if(!bar||!txt)return;
  let s=0;if(v.length>=8)s++;if(/[A-Z]/.test(v))s++;if(/[0-9]/.test(v))s++;if(/[^A-Za-z0-9]/.test(v))s++;
  const cols=['bg-rose-400','bg-orange-400','bg-amber-400','bg-sage-500'];
  const labs=['Weak','Fair','Good','Strong'];
  const off='bg-parchment-200 dark:bg-charcoal-700';
  bar.innerHTML=[0,1,2,3].map(i=>`<div class="h-1.5 flex-1 rounded-full transition-colors duration-300 ${i<s?cols[Math.min(s-1,3)]:off}"></div>`).join('');
  if(!v){txt.textContent='Enter a password';txt.className='mt-1.5 text-xs text-charcoal-400'}
  else{txt.textContent=labs[Math.min(s-1,3)]||'Too short';txt.className=`mt-1.5 text-xs font-medium ${s>=3?'text-sage-600 dark:text-sage-400':s>=2?'text-amber-600 dark:text-amber-400':'text-rose-500 dark:text-rose-400'}`}
}

// init
function onHash(){S.route=window.location.hash||'#/feed';S.loading=false;render();window.scrollTo({top:0,behavior:'instant'})}
window.addEventListener('hashchange',onHash);
restoreSession();
if(!window.location.hash)window.location.hash='#/feed';
onHash();
</script>
</body>
</html>
